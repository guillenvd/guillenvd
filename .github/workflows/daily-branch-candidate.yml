name: Create Daily Release Candidate Branch and Open PR

on:
  workflow_dispatch:  # Allows you to manually trigger the action from the GitHub UI
  schedule:
    - cron: '10 19 * * *'  # Runs every day at 11:30 AM Pacific Time during Standard Time (UTC-8)
    - cron: '0 23 * * *'   # Runs every day at 3 PM Pacific Time during Standard Time (UTC-8)
    - cron: '10 18 * * *'  # Runs every day at 11:30 AM Pacific Time during Daylight Saving Time (UTC-7)
    - cron: '0 22 * * *'   # Runs every day at 3 PM Pacific Time during Daylight Saving Time (UTC-7)

jobs:
  create_branch_and_pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout release branch
        uses: actions/checkout@v4
        with:
          ref: release  # Checkout the release branch
          fetch-depth: 0  # Fetch all history for all branches

      - name: Fetch the latest release branch
        run: |
          git fetch origin release:release

      - name: Checkout release branch
        run: |
          git checkout release
          git pull origin release  # Pull the latest changes from the remote release branch

      - name: Get the current date and hour
        id: datetime
        run: echo "datetime=$(date +'%d-%m-%Y-%H')" >> $GITHUB_ENV

      - name: Build new RC Branch name
        id: branch_name
        run: echo "branch_name="rc/${{ env.datetime }}"" >> $GITHUB_ENV


      - name: Create a new branch and Push
        run: |
          git rev-parse --abbrev-ref HEAD
          git checkout -b "${{ env.branch_name }}"
          git push origin "${{ env.branch_name }}"
          echo "Branch ${{ env.branch_name }} created and pushed to origin."

      - name: Create Pull Request RC to main
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: main  # PR will be merged into the main branch
          branch: "${{ env.branch_name }}"
          title: "Daily Release Candidate - ${{ env.branch_name }}"
          body: "This PR was automatically created by a GitHub Action and contains the daily release candidate."
          draft: false  # Set to true if you want the PR to be a draft
